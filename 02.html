<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>HgInit: Configurando para uma equipe</title>

<script src="c/jquery-1.4.1.js"></script>
<script src="c/basic.js"></script>

<link href="i/Hg.ico" rel="shortcut icon" />

<link href="c/styles.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-225715-20");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}</script>

	<!-- Google Website Optimizer Control Script -->
	<script>
	function utmx_section(){}function utmx(){}
	(function(){var k='2687020024',d=document,l=d.location,c=d.cookie;function f(n){
	if(c){var i=c.indexOf(n+'=');if(i>-1){var j=c.indexOf(';',i);return c.substring(i+n.
	length+1,j<0?c.length:j)}}}var x=f('__utmx'),xx=f('__utmxx'),h=l.hash;
	d.write('<sc'+'ript src="'+
	'http'+(l.protocol=='https:'?'s://ssl':'://www')+'.google-analytics.com'
	+'/siteopt.js?v=1&utmxkey='+k+'&utmx='+(x?x:'')+'&utmxx='+(xx?xx:'')+'&utmxtime='
	+new Date().valueOf()+(h?'&utmxhash='+escape(h.substr(1)):'')+
	'" type="text/javascript" charset="utf-8"></sc'+'ript>')})();
	</script><script>utmx("url",'A/B');</script>
	<!-- End of Google Website Optimizer Control Script -->
</head>
<body>
	<div id="kilnFlyOut">
		<div class="flyouttext">
		<strong>Kiln lhe oferece:</strong><br />

		&#8226; Controle de versão baseado no <a href="http://mercurial.selenic.com/" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/flyout/mercurial.selenic.com');">Mercurial</a> e <a href="http://git-scm.com">Git</a><br />
	  &#8226; <a href="http://www.fogcreek.com/kiln/features/team-up/" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/flyout/branchandmerge.kilnhg.com');">Ramificação e mesclagem</a> que realmente funciona
	  </div>
	  
	 <div class="flyouttext">
	  &#8226; Hospedagem segura em nossos servidores<br />
	  &#8226; <a href="http://www.fogcreek.com/kiln/features/code-reviews" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/flyout/startreviews.kilnhg.com');">Revisão de código</a> perfeitamente integrada
	  </div>
	 <div class="flyouttext"> <a href="https://secure.fogcreek.com/kiln/try/?fccmp=hginit" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/flyout/freetrial.shop.fogcreek.com');"><img src="i/getstarted.gif" width="182" height="24" border="0" /></a>
	 </div>
	 <div class="flyoutteaser"><nobr><strong>Experimente o Kiln!</strong> Hospedagem Mercurial e muito mais.</nobr></div>
	</div>

<div class="toptop" align="left">
    <ul>
        <li align="center"><a href="http://www.joelonsoftware.com/" onClick="javascript: pageTracker._trackPageview('/outbound/toptop/joelonsoftware.com');">Joel on Software</a></li>
        <li align="center"><a href="http://mercurial.selenic.com/" onClick="javascript: pageTracker._trackPageview('/outbound/toptop/mercurial.selenic.com');">Mercurial</a></li>
        <li align="center"><a href="index.html">Home</a></li>
    </ul>
</div>
<div id="dropshadow"></div>
<div id="topnav">
  <div class="tInterior">
      <a href="index.html">
        <img src="i/logo.png" border="0" alt="HgInit Home" />
      </a>
  
  Uma das vantagens de se usar o Mercurial é trabalhar
  com uma equipe no mesmo código.  O Mercurial permite
  que cada um trabalhe independentemente e consolida suas
  alterações juntas.

  </div>
</div>
<div class="main">
  <h1>Configurando para uma equipe</h1>
  <div class="content">
  
<p>A forma mais comum de se colaborar usando Mercurial é configurando um servidor central, além dos repositórios particulares que cada um tem em seus computadores.  Nós podems usar o repositório central como um espaço de trocas, onde nos reunimos para negociar sobre as alterações que estamos fazendo.</p>


<div><img src="i/02-repo.png" /></div>

<div class="cheatcontent" style="margin-top:0px">
<div class="cheattop">
	<div class="command">hg serve</div>
</div>
<p class="cheattext">executa um servidor web para tornar o repositório atual disponível na Internet</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>



<p>O jeito rápido e rasteiro de se criar um repositório central é usar o servidor web embutido no Mercurial&#8212;tudo o que você precisa é criar um repositório com <strong>hg init</strong> e então serví-lo na rede com <strong>hg serve</strong>.  Por padrão ele será servido na porta 8000.</p>

<div class="codesnippet">
<div class="codetop"> </div>
<pre>
C:\&gt; <strong>mkdir CentralRepo</strong>

C:\&gt; <strong>cd CentralRepo</strong>

C:\CentralRepo&gt; <strong>hg init</strong>

C:\CentralRepo&gt; <strong>hg serve</strong>
</pre>
<div class="codebottom"> </div>
</div>


<p>Como este meu computador é chamado <strong>joel.example.com</strong>, eu posso só acessar <strong>http://joel.example.com:8000</strong> com um navegador web e confirmar que o servidor está ativo e sendo executado, ainda que o repositório esteja completamente vazio.</p>


<div><img src="i/02-web.png" /></div>

<div class="cheatcontent" style="margin-top:0px">
<div class="cheattop">
	<div class="command">hg clone</div>
</div>
<p class="cheattext">faz uma cópia completa de um repositório inteiro</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>



<p>Com o servidor web central sendo executado, eu posso <em>clonar</em> este repositório <em>do</em> servidor <em>em</em> algum lugar no meu próprio computador para meu uso.  Neste caso, este repositório está vazio agora, então eu obterei apenas um outro repositório vazio quando eu cloná-lo.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel&gt; <strong>hg clone http://joel.example.com:8000/ receitas</strong>
no changes found
updating to branch default
0 files updated, 0 files merged, 0 files removed, 0 files unresolved

C:\Users\joel&gt; <strong>cd receitas</strong>

C:\Users\joel\receitas&gt; <strong>dir</strong>
 Volume in drive C has no label.
 Volume Serial Number is 84BD-9C2C

 Directory of C:\Users\joel\receitas

02/08/2010  02:46 PM    &lt;DIR&gt;          .
02/08/2010  02:46 PM    &lt;DIR&gt;          ..
02/08/2010  02:46 PM    &lt;DIR&gt;          .hg
               0 File(s)              0 bytes
               3 Dir(s)  41,852,125,184 bytes free
</pre>
<div class="codebottom"> </div>
</div>

<p>Agora eu vou criar um arquivo chamado <strong>guac</strong> contendo a minha famosa receita de guacamole.</p>

<div class="edit1">
                <div class="edittopbefore" >
                guac </div>
                <div class="editcontent">
* 2 abacates maduros<br>
* 1/2 cebola roxa picada (cerca de 1/2 xícara)<br>
* 1-2 pimentas dedo-de-moça, sem talo e sem sementes, picadas<br>
* 2 colheres de sopa de coentro picado bem fininho<br>
* 1 colher de sopa de suco de limão<br>
* 1/2 colher de chá de sal grosso<br>
* Uma pitada de pimenta-do-reino moída na hora<br>
* 1/2 tomate maduro, sem pele e sem sementes, picado<br><br>

Misture bem todos os ingredientes juntos.<br>
Sirva com salgadinhos tipo nachos.<br>
                </div>
                <img src="i/edit-bot.gif" width="387" height="76" />
    </div>
 
 <div style="clear: both;">&nbsp;</div>




<p>Vou adicionar este arquivo e dar commit nesta primeira versão oficial:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg add</strong>
adding guac

C:\Users\joel\receitas&gt; <strong>hg commit</strong>
</pre>
<div class="codebottom"> </div>
</div>

<p>Vou escrever um comentário para o commit:</p>


<img src="i/02-commit0.png">


<p>Vou editar brevemente este arquivo e fazer uma pequena alteração, só para
que ele tenha algum histórico no repositório.</p>

<div class="edit1">
                <div class="edittopbefore">
                guac </div>
                <div class="editcontent">
&#8230;<br>
* Uma pitada de pimenta-do-reino moída na hora<br>
* 1/2 tomate maduro, sem pele e sem sementes, picado<br><br>

Misture bem todos os ingredientes juntos.<br>
Sirva com salgadinhos tipo nachos.<br>
                </div>
                <img src="i/edit-bot.gif" width="387" height="76" />
    </div>


<div class="edit2">
	<img src="i/arrow2.gif" width="83" height="97" class="editArrow" />
	<div class="edittopafter">    
		guac
	</div>

  <div class="editcontent">
&#8230;<br>
* Uma pitada de pimenta-do-reino moída na hora<br>
* 1/2 tomate maduro, sem pele e sem sementes, picado<br><br>

<strong>Amasse</strong> todos os ingredientes juntos.<br>
Sirva com salgadinhos tipo nachos.<br>
   </div>
  <img src="i/edit-bot.gif" width="387" height="76" />
 </div>
 
 <div style="clear: both;">&nbsp;</div>
 
 
<p>Agora vamos dar commit nesta alteração:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">

C:\Users\joel\receitas&gt; <strong>hg status</strong>
M guac

C:\Users\joel\receitas&gt; <strong>hg diff guac</strong>
diff -r c1fb7e7fbe50 guac
--- a/guac      Mon Feb 08 14:50:08 2010 -0500
+++ b/guac      Mon Feb 08 14:51:08 2010 -0500
@@ -7,5 +7,5 @@
 * Uma pitada de pimenta-do-reino moída na hora
 * 1/2 tomate maduro, sem pele e sem sementes, picado

-Misture bem todos os ingredientes juntos.
+Amasse todos os ingredientes juntos.
 Sirva com salgadinhos tipo nachos.

C:\Users\joel\receitas&gt; <strong>hg com -m "Troca misturar bem por amassar"</strong>

C:\Users\joel\receitas&gt; <strong>hg log</strong>
changeset:   1:a52881ed530d
tag:         tip
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe
</pre>
<div class="codebottom"> </div>
</div>

<p>Perceba que quando eu dei commit desta vez, eu usei o argumento <strong>-m</strong> que eu não tinha utilizado antes.  Isto é só uma forma de prover uma mensagem para o commit na linha de comando, sem ter que usar o editor de texto.</p>

<p>OK, onde estávamos?  Até agora eu tenho repositório central e meu clone dele.  Já fiz duas alterações e dei commit nelas, mas tais alterações estão somente em meu clone&#8212;elas não estão no repositório central ainda.  Então o cenário se parece com isto:</p>


   <div><img src="i/02-repo-2.png" /></div>



<div class="cheatcontent" style="margin-top:0px">
<div class="cheattop">
	<div class="command">hg push</div>
</div>
<p class="cheattext">transfere novas alterações de um repositório para outro</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>


<p>Agora eu vou utilizar o comando <strong>hg push</strong>, que vai transferir minhas alterações do meu repositório para o repositório central:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg push</strong>
pushing to http://joel.example.com:8000/
searching for changes
ssl required
</pre>
<div class="codebottom"> </div>
</div>

<p>Ah, que ótimo.  Ele percebe que não vai funcionar.  Eu esqueci de pensar sobre as implicações de segurança de apenas executar um servidor web e permitir que qualquer pessoa no mundo possa transferir suas alterações estúpidas nele.  Tenha paciência comigo por um instante; vou configurar este servidor para que ele permita que qualquer pessoa no mundo faça qualquer coisa que quiser com ele.  Isto pode ser feito editando-se o arquivo .hg\hgrc no servidor:</p>
<div class="edit1">
                <div class="edittopbefore">
                .hg\hgrc </div>
                <div class="editcontent">
                    [web]<br />
                    push_ssl=False<br />
                    allow_push=*<br />
                </div>
                <img src="i/edit-bot.gif" width="387" height="76" />
    </div>

 <div style="clear: both;">&nbsp;</div>

<p>Desnecessário dizer que isto é bastante inseguro, mas se você estiver em uma boa rede LAN protegida no trabalho e tiver um bom firewall e se você confia em todos os usuários na sua rede, esta configuração é até bem razoável.  Caso contrário, você vai precisar ler os capítulos avançados sobre segurança.</p>

<p>OK, vamos executar o servidor novamente:</p>

<div class="codesnippet">
<div class="codetop"> </div>
<pre>
C:\CentralRepo> <strong>hg serve</strong>
</pre>
<div class="codebottom"> </div>
</div>


<p>E agora eu devo ser capaz de transferir para ele:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg push</strong>
pushing to http://joel.example.com:8000/
searching for changes
adding changesets
adding manifests
adding file changes
added 2 changesets with 2 changes to 1 files
</pre>
<div class="codebottom"> </div>
</div>

<p>Opa!  Agora o cenário é algo assim:</p>


   <img src="i/02-repo-3.png" />

<p>Eu sei o que você está pensando.  Você está pensando, &#8220;Puxa, Joel, isso é estranho!  Por que estes repositório contém <em>alterações</em> ao invés de conter <em>arquivos</em>?  Onde o arquivo <strong>guac</strong> fica, afinal?&#8221;</p>

<p>Sim, é estranho.  Mas é assim que o controle de versão distribuído funciona.  Os repositórios apenas contém grandes conjuntos de alterações.  Imagine que uma alteração é como se fosse uma folha de transparência.  Quando você tem várias delas e você as junta umas sobre as outras em ordem, com a última alteração no topo e olha através delas, &#8212;tcharam!&#8212;eis que você vê a versão atual do arquivo.  E conforme você retira as transparências do topo da pilha, então você vê como era o arquivo nas versões mais antigas.</p>

<p>Podemos usar nosso navegador web para dar uma olhada no repositório central agora:</p>


  <img src="i/02-web-2.png" />


<p>Exatamente o que você poderia esperar.</p>

<p>Agora eu quero que a Rose me ajude com esta receita.  A Rose é da equipe de testes.  Ela parece aquelas senhores de meia idade que costuma jogar no bingo, talvez passando horas sentada na frente de um caça-níquel, e apenas ela está testando o software.  Você pode lhe fornecer uma nova versão de seu código-fonte que ela é capaz de seguir um roteiro para testá-lo em 23 diferentes distribuições Linux, meticulosamente uma depois da outra, sem expressão, sem envolvimento, pausando só de vez em quando para comunicar que um texto não aparece corretamente quando o sistema operacional está no idioma turco, ou coisa do tipo.  Na verdade, a Rose é uma excelente testadora, mas eu acho que às vezes ela age mais como um zumbi.</p>





<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose&gt; <strong>hg clone http://joel.example.com:8000/ receitas</strong>
requesting all changes
adding changesets
adding manifests
adding file changes
added 2 changesets with 2 changes to 1 files
updating to branch default
1 files updated, 0 files merged, 0 files removed, 0 files unresolved
</pre>
<div class="codebottom"> </div>
</div>



<p>A Rose usou o comando <strong>hg clone</strong> para obter ela mesma uma cópia completa do repositório.  O <strong>hg clone</strong> recebe dois argumentos: a URL do repositório e o nome do diretório local aonde você quer que ele seja clonado.  E ela criou sua própria pasta <strong>receitas</strong>.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose&gt; <strong>cd receitas</strong>

C:\Users\rose\receitas&gt; <strong>dir</strong>
 Volume in drive C has no label.
 Volume Serial Number is 84BD-9C2C

 Directory of C:\Users\rose\receitas

02/08/2010  03:23 PM    &lt;DIR&gt;          .
02/08/2010  03:23 PM    &lt;DIR&gt;          ..
02/08/2010  03:23 PM    &lt;DIR&gt;          .hg
02/08/2010  03:23 PM               394 guac
               1 File(s)            394 bytes
               3 Dir(s)  41,871,872,000 bytes free

C:\Users\rose\receitas&gt; <strong>hg log</strong>
changeset:   1:a52881ed530d
tag:         tip
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe
</pre>
<div class="codebottom"> </div>
</div>

<p>Veja agora que quando ela digita <strong>hg log</strong> ela vê o histórico completo.  Ela na verdade baixou o repositório interiro, o que inclui o histórico completo de tudo que aconteceu.</p>

<p>A Rose está para fazer uma alteração e submetê-la:</p>

<div class="edit1">
                <div class="edittopbefore">
                guac </div>
                <div class="editcontent">
* 2 abacates maduros<br>
* 1/2 cebola roxa picada (cerca de 1/2 xícara)<br>
* 1-2 pimentas dedo-de-moça, sem talo e sem sementes, picadas<br>
* 2 colheres de sopa de coentro picado bem fininho<br>
* 1 colher de sopa de suco de limão<br>
&#8230;
                </div>
                <img src="i/edit-bot.gif" width="387" height="76" />
    </div>


<div class="edit2">
	<img src="i/arrow2.gif" width="83" height="97" class="editArrow" />
	<div class="edittopafter">    
		guac
	</div>
  <div class="editcontent">
* 2 abacates maduros<br>
* 1/2 cebola roxa picada (cerca de 1/2 xícara)<br>
* 1-2 pimentas <strong>habanero</strong>, sem talo e sem sementes, picadas<br>
* 2 colheres de sopa de coentro picado bem fininho<br>
* 1 colher de sopa de suco de limão<br>
&#8230;<br>
   </div>
  <img src="i/edit-bot.gif" width="387" height="76" />
 </div>
 
 <div style="clear: both;">&nbsp;</div>

 
<p>E agora ela dá commit no arquivo.  Perceba que ela consegue fazer isso mesmo se o servidor não estiver rodando: o commit acontece inteiramente apenas na máquina dela.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg diff</strong>
diff -r a52881ed530d guac
--- a/guac      Mon Feb 08 14:51:18 2010 -0500
+++ b/guac      Mon Feb 08 15:28:57 2010 -0500
@@ -1,6 +1,6 @@
 * 2 abacates maduros
 * 1/2 cebola roxa picada (cerca de 1/2 xícara)
-* 1-2 pimentas dedo-de-moça, sem talo e sem sementes, picadas
+* 1-2 pimentas habanero, sem talo e sem sementes, picadas
 * 2 colheres de sopa de coentro picado bem fininho
 * 1 colher de sopa de suco de limão
 * 1/2 colher de chá de sal grosso

C:\Users\rose\receitas&gt; <strong>hg com -m "pimenta mais ardida"</strong>

C:\Users\rose\receitas&gt; <strong>hg log</strong>
changeset:   2:689026657682
tag:         tip
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida

changeset:   1:a52881ed530d
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe
</pre>
<div class="codebottom"> </div>
</div>

<p>Enquanto a Rose estava fazendo estas suas alterações, eu posso alterar alterar meu arquivo ao mesmo tempo.</p>

<div class="edit1">
                <div class="edittopbefore">
                guac </div>
                <div class="editcontent">
&#8230;<br>
* 1/2 tomate maduro, sem pele e sem sementes, picado<br><br>

Amasse todos os ingredientes juntos.<br>
Sirva com salgadinhos tipo nachos.<br>
                </div>
                <img src="i/edit-bot.gif" width="387" height="76" />
    </div>


<div class="edit2">
	<img src="i/arrow2.gif" width="83" height="97" class="editArrow" />
	<div class="edittopafter">    
		guac
	</div>
  <div class="editcontent">
&#8230;<br>
* 1/2 tomate maduro, sem pele e sem sementes, picado<br><br>

Amasse todos os ingredientes juntos.<br>
Sirva com <strong>batatas chips</strong>.
   </div>
  <img src="i/edit-bot.gif" width="387" height="76" />
 </div>
 
 <div style="clear: both;">&nbsp;</div>



<p>Depois que eu submeter isto, você vai ver que meu log mostra algo que o changeset #2 é algo diferente do que o que aparece no log da Rose.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg com -m "batatas chips. Ninguém come uma só."</strong>

C:\Users\joel\receitas&gt; <strong>hg log</strong>
changeset:   2:4ecdb2401ab4
tag:         tip
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 15:32:01 2010 -0500
summary:     batatas chips. Ninguém come uma só.

changeset:   1:a52881ed530d
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe
</pre>
<div class="codebottom"> </div>
</div>

<p>Os nossos históricos estão ficando diferentes.</p>


  <img src="i/02-repo-4.png" />


<p>Não se preocupe&#8230; num instante vamos ver como consolidar essas alterações divergentes juntas numa única receita à base de pimenta habanero e batatas chips.</p>

<div class="cheatcontent" style="margin-top:-15px">
<div class="cheattop">
	<div class="command">hg outgoing</div>
</div>
<p class="cheattext">lista as alterações no repositório atual que estão aguardando para serem transferidas</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>


<p>A Rose pode continuar trabalhando, desconectada, fazendo todas as alterações que ela quiser, dar commit, ou revertê-las, em seu próprio repositório.  Em algum momento, porém, ela pode querer compartilhar as alterações que ela tem feito com o restante do mundo.  Ela pode digitar <strong>hg outgoing</strong> para ter uma listagem das alterações que ainda estão aguardando para serem enviadas para o repositório central.  Estas são as alterações que o <strong>hg push</strong> vai enviar quando ela executar <strong>hg push</strong>.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg outgoing</strong>
comparing with http://joel.example.com:8000/
searching for changes
changeset:   2:689026657682
tag:         tip
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida
</pre>
<div class="codebottom"> </div>
</div>

<p>Pense no <strong>hg outgoing</strong> simplesmente desta forma: uma lista de quaisquer alterações no seu repositório que ainda não estão no repositório central.</p>

<p>OK, então a Rose transfere as alterações dela.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg push</strong>
pushing to http://joel.example.com:8000/
searching for changes
adding changesets
adding manifests
adding file changes
added 1 changesets with 1 changes to 1 files
</pre>
<div class="codebottom"> </div>
</div>

<p>E o cenário geral agora se parece com isto:</p>


  <img src="i/02-repo-5.png" />

<p>Quando eu voltar da minha pausa para o cafezinho, eu vou estar pronto para transferir a minha alteração da batata chip também.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg outgoing</strong>
comparing with http://joel.example.com:8000/
searching for changes
changeset:   2:4ecdb2401ab4
tag:         tip
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 15:32:01 2010 -0500
summary:     batatas chips. Ninguém come uma só.


C:\Users\joel\receitas&gt; <strong>hg push</strong>
pushing to http://joel.example.com:8000/
searching for changes
abort: push creates new remote heads!
(did you forget to merge? use push -f to force)
</pre>
<div class="codebottom"> </div>
</div>

<p>Ihhh!!  Falhou!  A propósito&#8230; e essa mensagem que apareceu aqui?  A que diz <strong>use push -f to force</strong>?  Este é um aviso <em>terrível</em>.  Nunca, nunca, JAMAIS use <strong>push -f</strong> para forçar.  Você vai se arrepender.  Acredite em mim por agora.</p>

<p>O motivo pelo qual o push da Rose funcionou enquanto que o meu não é por que batatas chips não combinam bem com guacamole.  Brincadeira!  Só queria ver se você ainda está acompanhando.</p>

<p>Meu push falhou porque nós dois fizemos alterações e então elas precisam ser consolidadas de alguma forma.  E o Mercurial sabe disso.</p>

<p>A primeira coisa que estou fazendo é conferir todas as atualizações que estão no repositório central e que eu não tenho ainda para que eu possa consolidá-las com as minhas.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg incoming</strong>
comparing with http://joel.example.com:8000/
searching for changes
changeset:   3:689026657682
tag:         tip
parent:      1:a52881ed530d
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida


C:\Users\joel\receitas&gt; <strong>hg pull</strong>
pulling from http://joel.example.com:8000/
searching for changes
adding changesets
adding manifests
adding file changes
added 1 changesets with 1 changes to 1 files (+1 heads)
(run 'hg heads' to see heads, 'hg merge' to merge)
</pre>
<div class="codebottom"> </div>
</div>

<p>O &#8220;+1 heads&#8221; aqui é parte do jargão aqui.  Isto é porque o meu repositório, que eu sabia que continha três alterações em sequência, é agora um monstro de duas cabeças, com duas diferentes alterações empilhadas precariamente, desse jeito:</p>

<div class="i">
  <img src="i/02-repo-6.png" />
</div>

<p>No momento eu tenho ambas versões no meu repositório&#8230;  Tenho a minha versão:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>type guac</strong>
* 2 abacates maduros
* 1/2 cebola roxa picada (cerca de 1/2 xícara)
* 1-2 pimentas dedo-de-moça, sem talo e sem sementes, picadas
* 2 colheres de sopa de coentro picado bem fininho
* 1 colher de sopa de suco de limão
* 1/2 colher de chá de sal grosso
* Uma pitada de pimenta-do-reino moída na hora
* 1/2 tomate maduro, sem pele e sem sementes, picado

Amasse todos os ingredientes juntos.
Sirva com batatas chips.
</pre>
<div class="codebottom"> </div>
</div>

<p>E também a versão da Rose:</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg cat -r 3 guac</strong>
* 2 abacates maduros
* 1/2 cebola roxa picada (cerca de 1/2 xícara)
* 1-2 pimentas habanero, sem talo e sem sementes, picadas
* 2 colheres de sopa de coentro picado bem fininho
* 1 colher de sopa de suco de limão
* 1/2 colher de chá de sal grosso
* Uma pitada de pimenta-do-reino moída na hora
* 1/2 tomate maduro, sem pele e sem sementes, picado

Amasse todos os ingredientes juntos.
Sirva com salgadinhos tipo nachos.
</pre>
<div class="codebottom"> </div>
</div>

<p>E é preciso consolidar as duas.  Por sorte, isso é fácil.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg merge</strong>
merging guac
0 files updated, 1 files merged, 0 files removed, 0 files unresolved
(branch merge, don't forget to commit)

C:\Users\joel\receitas&gt; <strong>type guac</strong>
* 2 abacates maduros
* 1/2 cebola roxa picada (cerca de 1/2 xícara)
* 1-2 pimentas habanero, sem talo e sem sementes, picadas
* 2 colheres de sopa de coentro picado bem fininho
* 1 colher de sopa de suco de limão
* 1/2 colher de chá de sal grosso
* Uma pitada de pimenta-do-reino moída na hora
* 1/2 tomate maduro, sem pele e sem sementes, picado

Amasse todos os ingredientes juntos.
Sirva com batatas chips.
</pre>
<div class="codebottom"> </div>
</div>


<p>Olha!  O comando <strong>hg merge</strong> combinou as duas cabeças em apenas uma.  Neste caso, como nós editamos o mesmo arquivo em partes diferentes, não houve nenhum conflito e a consolidação funcionou sem nenhum enrosco.</p>
<div class="cheatcontent" style="margin-top:-65px">
<div class="cheattop">
	<div class="command">hg merge</div>
</div>
<p class="cheattext">mescla duas cabeças</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>



<p>Eu ainda preciso dar commit.  Isto é importante.  Se a consolidação das versões falhar, eu sempre posso reverter e tentar novamente.  Como o merge foi um sucesso, eu agora então vou dar commit para poder transferí-las para o repositório central.</p>

<div class="codesnippetjoel">
<div class="codetop"> </div>
<pre class="joel">
C:\Users\joel\receitas&gt; <strong>hg commit -m "merge"</strong>

C:\Users\joel\receitas&gt; <strong>hg log</strong>
changeset:   4:0849ca96c304
tag:         tip
parent:      2:4ecdb2401ab4
parent:      3:689026657682
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 16:07:23 2010 -0500
summary:     merge

changeset:   3:689026657682
parent:      1:a52881ed530d
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida

changeset:   2:4ecdb2401ab4
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 15:32:01 2010 -0500
summary:     batatas chips. Ninguém come uma só.

changeset:   1:a52881ed530d
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe


C:\Users\joel\receitas&gt; <strong>hg out</strong>
comparing with http://joel.example.com:8000/
searching for changes
changeset:   2:4ecdb2401ab4
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 15:32:01 2010 -0500
summary:     batatas chips. Ninguém come uma só.

changeset:   4:0849ca96c304
tag:         tip
parent:      2:4ecdb2401ab4
parent:      3:689026657682
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 16:07:23 2010 -0500
summary:     merge


C:\Users\joel\receitas&gt; <strong>hg push</strong>
pushing to http://joel.example.com:8000/
searching for changes
adding changesets
adding manifests
adding file changes
added 2 changesets with 2 changes to 1 files
</pre>
<div class="codebottom"> </div>
</div>

<p>E agora o repositório central tem o mesmo conteúdo que eu tenho:</p>


<img src="i/02-repo-7.png" />


<p>OK, eu tenho as alterações minhas e as da Rose, mas a Rose ainda não tem as minhas alterações.</p>

<p>Uma coisa que eu esqueci de lhe dizer sobre a Rose.  Ela é médica.  Sim, médica de formação.  Não é esquisito?  Ela era uma destacada pediatra no hospital Mt. Sinai, provavelmente ganhando cinco vezes mais lá do que ganha aqui com essa coisa toda de teste de software.  Ninguém sabe realmente porque ela largou o ramo da medicina.  Os outros testadores acham que ela pode ter passado por alguma tragédia.  Ela parece que tinha uma família também; há uma foto de uma linda menina sobre sua mesa, mas pelo visto a Rose vive sozinha e não queremos nos intrometer.</p>

<p>A Rose precisa baixar as atualizações, todas as coisas novas que entraram no repositório.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg pull</strong>
pulling from http://joel.example.com:8000/
searching for changes
adding changesets
adding manifests
adding file changes
added 2 changesets with 2 changes to 1 files
(run 'hg update' to get a working copy)
</pre>
<div class="codebottom"> </div>
</div>

<p>É isso aí.  Agora, você pode achar isso um pouco estranho, mas por mais que a Rose tenha baixado aquelas atualizações para seu repositório, elas <em>ainda não estão em seu diretório de trabalho</em> no momento.</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>type guac</strong>
* 2 abacates maduros
* 1/2 cebola roxa picada (cerca de 1/2 xícara)
* 1-2 pimentas habanero, sem talo e sem sementes, picadas
* 2 colheres de sopa de coentro picado bem fininho
* 1 colher de sopa de suco de limão
* 1/2 colher de chá de sal grosso
* Uma pitada de pimenta-do-reino moída na hora
* 1/2 tomate maduro, sem pele e sem sementes, picado

Amasse todos os ingredientes juntos.
Sirva com salgadinhos tipo nachos.
</pre>
<div class="codebottom"> </div>
</div>

<p>Está vendo?  Ela ainda está trabalhando com salgadinhos tipo nachos.  Nachos!</p>

<p>Mas ela <em>tem</em> as minhas alterações em algum lugar em seu repositório&#8230;</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg log</strong>
changeset:   4:0849ca96c304
tag:         tip
parent:      3:4ecdb2401ab4
parent:      2:689026657682
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 16:07:23 2010 -0500
summary:     merge

changeset:   3:4ecdb2401ab4
parent:      1:a52881ed530d
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 15:32:01 2010 -0500
summary:     batatas chips. Ninguém come uma só.

changeset:   2:689026657682
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida

changeset:   1:a52881ed530d
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:51:18 2010 -0500
summary:     Troca misturar bem por amassar

changeset:   0:c1fb7e7fbe50
user:        Joel Spolsky &lt;joel@joelonsoftware.com&gt;
date:        Mon Feb 08 14:50:08 2010 -0500
summary:     Initial version of guacamole recipe
</pre>
<div class="codebottom"> </div>
</div>

<div class="cheatcontent" style="margin-top:0px">
<div class="cheattop">
	<div class="command">hg parent</div>
</div>
<p class="cheattext">mostra o changeset que está no diretório de trabalho</p>
<img src="i/cheatbot.png" width="241" height="41" />
</div>



<p>As minhas alterações apenas não estão no seu diretório de trabalho.  Isso porque ela ainda está trabalhando no changeset #2.  Você pode ver isso com o comando &#8220;parent&#8221;:</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg parent</strong>
changeset:   2:689026657682
user:        Rose Hillman &lt;rose@example.com&gt;
date:        Mon Feb 08 15:29:09 2010 -0500
summary:     pimenta mais ardida
</pre>
<div class="codebottom"> </div>
</div>

<p>O Mercurial está sendo legal com a gente.  É sempre seguro baixar atualizações; todo o que ele faz é receber as últimas atualizações que as outras pessoas vinham fazendo.  Podemos passar a utilizá-las e trabalhar com elas mais tarde, ou a nosso critério.</p>

<p>Lembre-se de que o comando <strong>hg up</strong> sem argumentos vai atualizar o diretório de trabalho para o <em>topo</em> (o changeset mais recente), neste caso o número 4:</p>

<div class="codesnippetrose">
<div class="codetop"> </div>
<pre class="rose">
C:\Users\rose\receitas&gt; <strong>hg up</strong>
1 files updated, 0 files merged, 0 files removed, 0 files unresolved

C:\Users\rose\receitas&gt; <strong>type guac</strong>
* 2 abacates maduros
* 1/2 cebola roxa picada (cerca de 1/2 xícara)
* 1-2 pimentas habanero, sem talo e sem sementes, picadas
* 2 colheres de sopa de coentro picado bem fininho
* 1 colher de sopa de suco de limão
* 1/2 colher de chá de sal grosso
* Uma pitada de pimenta-do-reino moída na hora
* 1/2 tomate maduro, sem pele e sem sementes, picado

Amasse todos os ingredientes juntos.
Sirva com batatas chips.
</pre>
<div class="codebottom"> </div>
</div>

<p>Agora sim ela está vendo a última versão do arquivo, que contém as alterações de todo mundo.</p>

<p>Quando você estiver trabalhando em equipe, seu fluxo de trabalho com o Mercurial será algo assim:</p>

<ol>
  <li>Se ainda não tiver feito isso, obtenha a versão mais recente, na qual todo mundo
      está trabalhando:</li>
  <ul>
      <li>hg pull</li>
      <li>hg up</li>
  </ul>
  <li>Faça suas alterações</li>
  <li>Dê commit nelas (localmente)</li>
  <li>Repita os passos 2-3 até que você tenha um código legal que você esteja disposto a compartilhar com todo mundo</li>
  <li>Quando você estiver pronto para compartilhar suas alterações:</li>
  <ul>
    <li>hg pull para obter as alterações das outras pessoas (se houver)</li>
    <li>hg merge para incorporar as alterações dos demais às suas</li>
    <li>testar! para ter certeza de que o merge não estragou nada</li>
    <li>hg commit (o resultado do merge)</li>
    <li>hg push</li>
  </ul>
</ol>

<h2>Teste você mesmo</h2>

<p>Eis aqui as coisas que você deve saber depois da leitura deste tutorial:</p>

<ol>
  <li>Configurar um repositório central e permitir que os membros da equipe façam clones a partir dele</li>
  <li>Transferir alterações para o repositório central</li>
  <li>Baixar alterações a partir do repositório central</li>
  <li>Incorporar atualizações de diferentes contribuidores</li>
</li>
</ol>

<div class="footer">
 <div class="footernav" id="home" align="center"><a href="index.html"><span class="angleQuote">&#171;</span> Home</a></div>
 
<div class="footernav" id="comingup">A seguir, vamos falar sobre como corrigir <span style="text-decoration: line-through;">engnaos</span> enganos.</div>
<div class="footernav" id="next" align="center"><a href="03.html">Próx. <span class="angleQuote">&#187;</span></a></div>


 
 
 </div>    

<div class="pagebottom">

        <div class="bottomimg">
		<a href="http://www.kilnhg.com" target="_blank" id="logoLink" title="KilnHg.com" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/klinhg.com');">&nbsp;</a>
		<div class="bottomtext">This tutorial was brought to you by the fine folks at Fog Creek Software, makers of Kiln, a version control system powered by Mercurial</div>
        
        <div class="bottomtext"><strong>Kiln lhe oferece:</strong><br />

&#8226; Um sistema de controle de versão completo baseado no <a href="http://mercurial.selenic.com/" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/mercurial.selenic.com');">Mercurial</a> e <a href="http://git-scm.com">Git</a><br />
&#8226; <a href="http://www.fogcreek.com/kiln/features/team-up" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/branchandmerge.kilnhg.com');">Ramificação e mesclagem</a> que realmente funcionam<br />
&#8226; Hospedagem segura em nossos servidores<br />
&#8226; <a href="http://www.fogcreek.com/kiln/features/code-reviews" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/startreviews.kilnhg.com');">Revisão de código</a> perfeitamente integrada<br />
</div>
      
      <div class="bottomtext getStarted">
      <a href="https://secure.fogcreek.com/kiln/try/?fccmp=hginit" target="_blank" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/freetrial.shop.fogcreek.com');"><img src="i/getstarted.gif" width="182" height="24" border="0" /></a>
      </div>  
        
      </div>             
        <div class="about">
          <p>
            <strong>Quer mais?</strong>
          </p>
          
          <p>
            A Fog Creek oferece webinários mensais gratuitos que abordam além dos conceitos básicos do Mercurial.
            Cadastre-se em <a href="http://www.fogcreek.com/kiln/training/#training">fogcreek.com</a>.
          </p>

          <p>
            <strong>Perguntas?</strong>
          </p>
          
          <p>
            Procurando ajuda com o <a href="http://fogcreek.com/kiln">Kiln</a>?  Confira a <a href="http://help.fogcreek.com/kiln">Base de Conhecimentos do Kiln</a>.
          </p>

          <p>
            <strong>Sobre o autor.</strong>
          </p> 
        
          <p>
Joel Spolsky é o fundador da <a href="http://fogcreek.com" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/fogcreek.com');">Fog Creek Software</a>, uma empresa de Nova York que prova que você pode tratar bem seus programadores e ainda assim ser lucrativo.  Os programadores têm escritórios particulares, almoço gratuito e trabalham não mais que 40 horas por semana.  Os clientes só pagam pelo software se eles gostarem do resultado.  A Fog Creek é a criadora do <a href="http://www.fogbugz.com" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/fogbugz.com');">FogBugz</a>, do <a href="http://www.kilnhg.com/" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/text.kilnhg.com');">Kiln</a> e do <a href="https://www.copilot.com/" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/copilot.com');">Fog Creek Copilot</a>.  O blog do Joel, <a href="http://www.joelonsoftware.com/" onClick="javascript: pageTracker._trackPageview('/outbound/bottom/joelonsoftware.com');">Joel on Software</a>, é uma referência para programadores no mundo todo.
            
           </p>
        
        </div>


<!-- close bottom div -->
</div>
    
    
<!-- close "content" column -->     
</div>

<!-- close "main" div -->
</div>

<!-- bottom grey bar -->
<div class="botbot" align="left">
</div>

<!-- Google Website Optimizer Tracking Script -->
<script type="text/javascript">
if(typeof(_gat)!='object')document.write('<sc'+'ript src="http'+
(document.location.protocol=='https:'?'s://ssl':'://www')+
'.google-analytics.com/ga.js"></sc'+'ript>')</script>
<script type="text/javascript">
try {
var gwoTracker=_gat._getTracker("UA-225715-15");
gwoTracker._trackPageview("/2687020024/test");
}catch(err){}</script>
<!-- End of Google Website Optimizer Tracking Script -->

</body>

</html>
